---
description: Code structure rules
globs:
alwaysApply: true
---

# Code Structure Rules 

## Folder Structure & Placement
1. **Feature-First Architecture** (`lib/features/`)
   - **New Feature?** → Create `lib/features/<FeatureName>/`
   - **UI/Pages?** → `lib/features/<feature>/presentation/`
   - **State/Logic?** → `lib/features/<feature>/logic/`
   - **Feature-specific helpers?** → `lib/features/<feature>/logic/` or `.presentation/utils/`

2. **Core & Shared**
   - **Global Utilities (Dates, Strings)?** → `lib/core/utils/`
   - **Global UI (Themes, Colors)?** → `lib/core/theme/`
   - **Infrastructure (Auth, API, DB)?** → `lib/services/` (or `lib/core/services/`)
   - **Shared Widgets (Buttons, Dialogs)?** → `lib/shared_ui/`

## Hard limits
- **Max 750 lines/file** → `#SPLIT_FILE`
- **Max 150 lines/function** → `#REFACTOR_NOW`
- **No business logic in `build()`** → `#EXTRACT_LOGIC`

## Anti-patterns (Never do)
- **Tangled Dependencies**: Feature A should not import Feature B's *logic* directly. Use a shared service or event bus.
- **Fat Controllers**: Don't put UI code in Logic classes, and don't put Logic in UI classes.
- **"Helper" Dumping**: Avoid vague `Helper` folders. Ask: Is it a *Service*? A *Util*? Or *Logic*?
- **Direct Database in UI**: UI widgets should call a **Logic** or **Service** class, never `Firestore.instance` directly.

## Quick checklist (before creating files)
- [ ] Am I creating a new feature? → `lib/features/`
- [ ] Is this used by multiple features? → `lib/core/` or `lib/services/`
- [ ] Is this purely logic? → `logic/` directory (not inside a Widget file)
